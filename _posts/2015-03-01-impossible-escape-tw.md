---
layout: post
title: 囚犯的謎題
category: math
tags: puzzle
---

前一陣子看到一個 [謎題](http://datagenetics.com/blog/december12014/index.html),
乍看之下覺得這怎麼可能有解
（老實說我想了一陣子也解不出來）。
不過既然被寫在 blog 上面，
通常應該就是有解的。
好，謎題如下：

* 你和一個朋友被關進大牢裡。
國王給你們一個被釋放的機會。
明天你一個人進到一個房間裡。
裏面有個 64 格的棋盤。
一個獄卒也在裏面。
他會在棋盤上每一格放一個銅板，
有的正面朝上，
有的反面朝上。
沒有人知道他哪一格會放正面或反面，
連他自己也是在最後一秒才決定。
你可以看著他放銅板，
但是如果你想要使用任何方法影響他放銅板的方式，
抱歉，
立刻砍頭。
所以你看到的可能性共有
\\(2^{64} = 1.84467\dots \times 10^{19}\\) 種。你無法預測。

* 然後獄卒會任意指著 64 格的其中一格，說這個是救命方格。

* 然後你唯一能做的事是將 64 個銅板中的一個銅板翻面。你只能翻一個，但是你可以任意選擇。
正面翻到反面或是反面翻到正面。除此之外不能動任何東西。

* 之後你會被帶離開房間。如果你想留下任何其他線索，或是想打暗號給你的同伴，對，立刻砍頭。

* 然後你的朋友會被帶進房間。他只能看棋盤上的銅板，不能碰。
他要根據棋盤上的銅板猜出救命方格是哪一個。只有一次機會，沒有任何其他的線索。
如果他答對，你們兩個都會被釋放。如果答錯，那就要抓出去砍了。

* 你們兩個現在知道規則了。你們有 24 小時想出一個策略要怎麼決定翻哪一個銅板，
及如何猜出哪一個是救命方格。

這可能嗎？只能動一個銅板如何傳遞 64 選一的訊息呢？
這不是腦筋急轉彎，是貨真價實的數學謎題。
有興趣的人可以先停下來想一下，先不要繼續讀下去。

<div style="text-align:center" markdown="1">
![]({{ site.url }}/images/2015/coinsonboard.png "Coins on a chess board"){: .center-image }
</div>

### 提示

想到了嗎？如果沒有，從最簡單的情況開始想。

如果只有兩個格子，我們需要傳遞的訊息需要有兩種可能：第一格或第二格，
也就是一個 bit 的訊息量 （\\(2^1 = 2\\)）。

銅板會有四種組合： HH, HT, TH, HH。H 代表正面，T 代表反面。

我們發現，不管一開始銅板的組合是什麼，我們可以翻一個銅板來完全控制其中一個銅板的方向。
譬如說我們要控制第二格，我想要它是 H。如果我看到 HH 或 TH，我就去翻第一格，
保持第二格 H。如果本來是 HT 或 TT，我就去翻第二格，把它翻成 H。
如果想要它是 T 就反過來做。

所以如果今天謎題只用兩個銅板，你可以跟你的朋友說，看第二格。如果救命方格是第一格，
我會把第二格控制成 T。如果救命方格是第二格，我會把第二格控制成 H。
所以根據第二格的銅板你可以猜出救命方格是哪一個。

所以，兩個銅板可以傳遞一個 bit 的訊息。
也就是說，我們可以用 HT 和 TT 來代表 0，用 TH 和 HH 來代表 1。

我們可以翻第一個銅板來維持原始狀態，翻第二個銅板來翻轉原始狀態。

### 下一步

怎麼推廣到 64 格呢？在那之前我們先來看看 4 格的情況。我們需要
2 bits （\\(2^2 = 4\\)）來傳遞四選一的訊息。
既然我們已經解決兩格的問題，如果可以把四格問題拆成兩個兩格問題，也許就解決了。

首先，把四格分成 A，B 兩組 AABB。
現在把 AA 視為兩格問題的第一格，把 BB 視為兩格問題的第二格。

再來需要推廣正反面的定義因為現在一組裡有超過一個銅板。
如果一組內有奇數個正面（H），該組視為正面（H），
如果有偶數個正面，該組視為反面（T）。

所以，xxTT 和 xxHH 相當於兩格問題裡的 xT。這樣這個 bit 等於 0。
xxTH 和 xxHT 相當於 xH，bit 等於 1。

那第二個 bit 在哪裏？四格還可以分成 ABAB 兩組。用同樣的邏輯，
xTxT 和 xHxH 等於 0，xTxH 和 xHxT 等於 1。

把這兩個 bits 合併，我們得到以下的表：

<pre>
HTTT = 0 0     THTT = 0 1     TTHT = 1 0     TTTH = 1 1
HHTT = 0 1     HTHT = 1 0     HTTH = 1 1     THHT = 1 1     THTH = 1 0     TTHH = 0 1
HHHT = 1 1     HHTH = 1 0     HTHH = 0 1     THHH = 0 0
TTTT = 0 0     HHHH = 0 0
</pre>

四格的組合可以代表一個 2-bit 的數值。

同理 8 格的組合可以代表一個 3-bit 的數值。
這三個 bits 分別可以用 AAAABBBB，AABBAABB，ABABABAB 三種分組方式代表。
我們可以歸納出，\\(2^n\\) 個銅板的任一組合可以代表一個 n-bit 的數值。

下一步是，把 \\(2^n\\)個方格從 0 到 \\(2^n-1\\) 編號後，一個 n-bit 的數值正好可以指出其中一個方格的位置。

### 如何翻轉

當獄卒擺出銅板的組合後，你可以根據以上的規則讀出一個 n-bit 的數字。
但是這個數字跟救命方格的位置沒有關係。現在你的工作是翻轉一個銅板，
讓你的同伴可以讀出另一個 n-bit 數字，正好可以代表救命方格的位置。

你需要 XOR 運算。

#### XOR

一般人應該比較了解 AND 和 OR 的邏輯運算。X 和 Y 兩者必須都為 True，
X AND Y 才會等於 True，否則等於 False。而 X OR Y 只要兩者其中至少有一個為 True，
就等於 True 。而 XOR 則是兩者只能正好有一個 True 才等於 True 。

用 0 和 1 來表示就是
<pre>
1 XOR 0 = 1       0 XOR 1 = 1
0 XOR 0 = 0       1 XOR 1 = 0
</pre>

由此可看出 "XOR 1" 是一個翻轉運算（0 變成 1， 1 變成 0）。
“XOR 0” 則是維持原狀的運算。

如果我們可以做 bit-by-bit XOR 的運算，我們就可以隨意的變換一個數字。
譬如說，要把 [1 0 1] 變成 [0 1 1] 需要翻轉前兩個 bits，也就是
<pre>
[1 0 1] XOR [1 1 0] = [0 1 1]
</pre>

有趣的是，等號右邊和等號左邊兩個的任一個交換，等號還是成立：

<pre>
If X XOR Y = Z    then    X XOR Z = Y,   Z XOR Y = X

[1 0 1] XOR [1 1 0] = [0 1 1]
[1 0 1] XOR [0 1 1] = [1 1 0]
[0 1 1] XOR [1 1 0] = [1 0 1]
</pre>

### 翻轉

再回頭看四格的例子。表中第一行的四個組合只用了一個 H。
也就是說，從 TTTT [0 0] 出發，翻轉一個銅板可以製造出所有 2 bits 的組合
[0 0], [0 1], [1 0], [1 1]。

事實上，不管從哪一個組合開始，翻轉其中一個銅板，就可以製造出任意的 0,1 的組合。
運算正好是一個 XOR 的運算。

翻轉第 0 個銅板，數值不會改變（TTTT = HTTT = [0 0] ），相當於 XOR [0 0]。
翻轉第 1 個（TTTT -> THTT = [0 1] ）相當於 XOR [0 1]。
依此類推。

如果一開始的組合是 HHTT = [0 1]，救命方格是第 3 格（3 = [1 1]），
你要翻轉第 0 個 bit，也就是 XOR [1 0] 才會變成 [1 1]。
所以你要翻轉第 2 個銅板（記得從 0 算起）因為 TTHT = [1 0]。

<pre>
HHTT -> HHHT = [1 1]
</pre>

你個同伴看到 HHHT 就知道是 [1 1]= 3，救命方格是第 3 格。


### 結論

解密的策略如下。

* 將 64 格從 0 到 63 編號。這需要 6 bits (\\(64 = 2^6\\)):
<code>
0 = 000000, 1 = 000001, 2 = 000010, ... , 62 = 111110, 63 = 111111。
</code>
* 我們需要 6 種方法將 64 格分成 A，B 兩組。每一種分組法代表一個 bit。
我們現在把最右邊的 bit 叫做 bit 0，下一個叫 bit 1，等等。
那代表 bit k 的分組法即為：將方格編號除以 \\(2^k\\)，如果商數是偶數，該方格屬於 A 組。
如果商數是奇數，該方格屬於 B 組。
* 看到獄卒排出來的銅板後，用每一種分組法，算在 B 組的銅板裡的正面是奇數還是偶數。
如果是奇數，那個 bit 設為 1，偶數設為 0。
你會得到一個 6-bit 數字，叫它 M。
* 救命方格被指出後，它的位置的編號是另外一個 6-bit 數字，叫它 L。
* 用 bit-by-bit XOR 算出 N = M XOR L，然後翻轉編號 N 上的銅板。
現在 64 銅板的組合代表的 6-bit 數值即為 L （L = M XOR N）。
* 最後你的同伴進去，看到 64 銅板的組合，即可解讀出 L，然後指出救命方格的位置。

恭喜你，數學救了你的命 :D





